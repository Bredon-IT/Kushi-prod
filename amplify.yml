version: 2
frontend:
  phases:
    preBuild:
      commands:
        - echo "=== Listing all folders ==="
        - ls -R .

        - echo "=== Installing Customer App ==="
        - cd project && (npm ci || npm install)
        - cd ..

        - echo "=== Installing Admin App ==="
        - cd Admin/AdminDashboard && (npm ci || npm install)
        - cd ../..

    build:
      commands:
        - rm -rf dist && mkdir -p dist

        - echo "=== Building Customer App ==="
        - cd project && npm run build
        - cp -r dist/* ../dist/
        - cd ..

        - echo "=== Building Admin App ==="
        - cd Admin/AdminDashboard && npm run build
        - mkdir -p ../../dist/admin
        - cp -r dist/* ../../dist/admin/
        - cd ../..

    postBuild:
      commands:
        - echo "ðŸŽ‰ Both Customer + Admin Built Successfully!"

  artifacts:
    baseDirectory: dist
    files:
      - '**/*'

rewrites:
  - source: /admin/<*>
    target: /admin/index.html
    status: 200

  - source: /<*>
    target: /index.html
    status: 200
