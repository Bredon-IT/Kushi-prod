version: 2
frontend:
  phases:
    preBuild:
      commands:
        # Install Customer app dependencies
        - cd project && (npm ci || npm install)
        - cd ..

        # Install Admin app dependencies
        - cd Admin/AdminDashboard && (npm ci || npm install)
        - cd ../..
        
    build:
      commands:
        # Clean dist folder
        - rm -rf dist && mkdir -p dist

        # ---------------------
        # Build Customer App
        # ---------------------
        - cd project && npm run build
        - cp -r dist/* ../dist/
        - cd ..

        # ---------------------
        # Build Admin App
        # ---------------------
        - cd Admin/AdminDashboard && npm run build
        - mkdir -p ../../dist/admin
        - cp -r dist/* ../../dist/admin/
        - cd ../..

    postBuild:
      commands:
        - echo "ðŸŽ‰ Both Customer + Admin Built Successfully!"

  artifacts:
    baseDirectory: dist
    files:
      - '**/*'

  cache:
    paths:
      - project/node_modules
      - Admin/AdminDashboard/node_modules

# ============================================================
# ðŸ§­ REWRITE RULES FOR REACT ROUTER SPA (ADMIN + CUSTOMER)
# ============================================================
rewrites:
  # Admin dashboard: /admin/... â†’ load admin index.html
  - source: "/admin/<*>"
    target: "/admin/index.html"
    status: 200

  # Customer website: all other routes â†’ load main index.html
  - source: "<*>"
    target: "/index.html"
    status: 200
